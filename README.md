# Вычислительный эксперимент

__Тема:__
Оптимизация прерываемых расписаний на одной машине заданных n работ с моментами времен доступности работ для их выполнения, продолжительностями выполнения каждой работы, весами (приоритетами) работ, штрафами за раннее и позднее завершение выполнения каждой работы, а также штрафами за ранний и поздний старт работ, минимизирующих суммарное взвешенное время по всем штрафам завершения всех работ

---------

Модели, данные и ноутбук для проведения вычислительного эксперимента.

## Ноутбук

jupyter notebook `index.ipynb`

- генерация задач
- решение задач, сохранение результатов в файлы
- подсчет статистики по результатам: таблицы, графики
- прочие вспомогательные функции

## Модель
Модели для решателя написаны на языке minizinc и запускаются из среды minizinc. В качестве решателя для ЛП и ЦЛП используется HiGHS (https://highs.dev)

`model_blp.mzn` -- модель целочисленного (двоичного) линейного программирования для решения задачи составления оптимального расписания с целью минимизировать общие штрафы, накладываемые на работы. (Параметры и целевая функция заявлены в теме)

`model_lp.mzn` -- релаксированная модель первичной задачи из `model_blp.mzn`, модель линейного программирования без целочисленных переменных.

## Данные

`data.zip` -- результаты, сгенерированные задачи, их решения.

Для подсчета статистики в ноутбуке, необходимо распаковать `data.zip` в директорию `./data`

__JSON__

Одна задача -- один файл. Файл содержит одновременно параметры задачи и её решения.

`./data/json`
`./data/json/n10p5` -- задачи с параметрами n=10, p=5
`./data/json/n3p5` -- задачи с параметрами n=3, p=5
и т.д.

К примеру `./data/json/n3p2/0a22c5da67cc35a46819c3ffc13f780e.json`

Структура JSON файла
```javascript
{
	// Уникальный идентификатор задачи (hash-функция от параметров задачи)
	"id": "0a22c5da67cc35a46819c3ffc13f780e",

	// Параметры задачи
	"params": {
		"p" : [2, 2, 2],    // Время работ / Количество операций в работах (p_j)
		"w" : [6, 2, 15],   // Приоритеты (w_j)
		"d1": [3, 4, 6],    // Ранее время завершения работ (e_j)
		"d2": [6, 5, 6],    // Позднее время завершения работ (d_j)
		"s1": [1, 4, 6],    // Ранее время начала работ (s_j)
		"s2": [1, 4, 6],    // Позднее время начала работ (S_j)
		"r" : [1, 2, 3]     // Время доступности работ (r_j)
	},
	
	// Общее время выполнения (секунды)
	"exec_time": 0.5686295032501221,
	
	// Результаты
	"results": {
	
		// Результаты оптимального решения задачи о назначениях (Венгерский алгоритм или алгоритм Куна-Манкреса)
		"lap_munkres": {
			// Решение, переменные
			"x": [
				[ 1, 0, 0, 0, 0, 0 ],
				[ 0, 0, 1, 0, 0, 0 ],
				[ 0, 1, 0, 0, 0, 0 ],
				[ 0, 0, 0, 1, 0, 0 ],
				[ 0, 0, 0, 0, 1, 0 ],
				[ 0, 0, 0, 0, 0, 1 ]
			],
			
			// Значение целевой функции
			"obj": 19,
			
			// Допустимый порядок (1 = Да, 0 = Нет)
			"ord": 1,
			
			// Время выполнения (секунды)
			"exec_time": 0
		},
		
		// Результаты оптимального решения задачи о назначениях (пакет scipy)
		"lap_2d_rect": {
			// Решение, переменные
			"x": [
				[ 1, 0, 0, 0, 0, 0 ],
				[ 0, 0, 1, 0, 0, 0 ],
				[ 0, 1, 0, 0, 0, 0 ],
				[ 0, 0, 0, 1, 0, 0 ],
				[ 0, 0, 0, 0, 1, 0 ],
				[ 0, 0, 0, 0, 0, 1 ]
			],
			
			// Значение целевой функции
			"obj": 19,
			
			// Допустимый порядок (1 = Да, 0 = Нет)
			"ord": 1,
			
			// Время выполнения (секунды)
			"exec_time": 0
		},

		// Результаты оптимального решения задачи ЦЛП
		"osp_blp": {
			// Решение, переменные x_{jkt}
			"x": [
				[
					[ 1, 0, 0, 0, 0, 0 ],
					[ 0, 0, 1, 0, 0, 0 ]
				], [
					[ 0, 1, 0, 0, 0, 0 ],
					[ 0, 0, 0, 1, 0, 0 ]
				], [
					[ 0, 0, 0, 0, 1, 0 ],
					[ 0, 0, 0, 0, 0, 1 ]
				]
			],
			
			// Значение целевой функции
			"obj": 19,
			
			// Время выполнения (секунды)
			"exec_time": 0.29599618911743164
		},
		
		// Результаты оптимального решения задачи ЛП (релаксация)
		"osp_lp": {
		
			// Решение, переменные x_{jkt}
			// В данном примере релаксация вернула целочисленное решение
			"x": [
				[
					[ 1, 0, 0, 0, 0, 0 ],
					[ 0, 0, 1, 0, 0, 0 ]
				], [
					[ 0, 1, 0, 0, 0, 0 ],
					[ 0, 0, 0, 1, 0, 0 ]
				], [
					[ 0, 0, 0, 0, 1, 0 ],
					[ 0, 0, 0, 0, 0, 1 ]
				]
			],
			
			// Значение целевой функции
			"obj": 19,
			
			// Допустимый порядок (1 = Да, 0 = Нет)
			// Если порядок допустимый -- релаксация вернула целочисленное решение
			"ord": 1,
			
			// Время выполнения (секунды)
			"exec_time": 0.29114651679992676
		},
		
		// Эвристика А1
		"a1": {
			// Вектор расписания
			"s": [
				1,2,1,2,3,3
			],
			
			// Значение целевой функции
			"obj": 19,
			
			// Время выполнения (секунды)
			"exec_time": 0
		},
	}
}
```

__TXT__

Одна задача -- один файл. Файл содержит только параметры задачи, разделенные пробелами и переводами строк. Формат удобный для stdin. Повторяет данные из JSON.

`./data/txt`
`./data/txt/n10p5` -- задачи с параметрами n=10, p=5
`./data/txt/n3p5` -- задачи с параметрами n=3, p=5
и т.д.

К примеру `./data/txt/n3p2/0a22c5da67cc35a46819c3ffc13f780e.txt`
```
3
2 2 2
6 2 15
1 2 3
1 4 6
1 4 6
3 4 6
6 5 6
```

Строка 1: `n` -- количество работ
Строка 2: `p` -- время работы, количество операций
Строка 3: `w` -- приоритеты
Строка 4: `r` -- время доступности работ
Строка 5: `s` -- раннее время начала работ
Строка 6: `S` -- позднее время начала работ
Строка 7: `e` -- раннее время завершения работ
Строка 8: `d` -- позднее время завершения работ


__CSV__
`./data/csv` -- результаты в формате csv (таблицы, читаются в excel)

Поля таблицы

| Поле                     |      Роль          |
|:-------------------------|:-------------------|
| id                       | уникальный идентификатор задачи (hash-функция от параметров задачи) |
| n                        | количество работ |
| lap_munkres.obj          | значение целевой функции решения задачи о назначениях (венгерский алгоритм) |
| lap_munkres.ord          |  допустимый порядок (1 = Да, 0 = Нет) |
| lap_munkres.exec_time    |  время выполнения (секунды) |
| lap_2d_rect.obj          |  значение целевой функции решения задачи о назначениях (scipy) |
| lap_2d_rect.ord          |  допустимый порядок (1 = Да, 0 = Нет) |
| lap_2d_rect.exec_time    |  время выполнения (секунды) |
| osp_blp.obj              |  значение целевой функции решения ЦЛП |
| osp_blp.exec_time        |  время выполнения (секунды) |
| osp_lp.obj               |  значение целевой функции решения ЛП |
| osp_lp.ord               |  допустимый порядок (1 = Да, 0 = Нет) |
| osp_lp.exec_time         |  время выполнения (секунды) |
| a1.obj                   |  значение целевой функции эвристика A1 |
| a1.exec_time             |  время выполнения (секунды) |














